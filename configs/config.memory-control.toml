# Edge Video - Configuração com Controle de Memória
# Configuração otimizada para prevenir travamento do sistema operacional

target_fps = 2.0
protocol = "amqp"

# ====================================================
# CONTROLE DE MEMÓRIA (NOVO)
# ====================================================
# Previne travamento do sistema operacional
# Sistema prefere executar MAIS LENTO do que travar
[memory]
enabled = true                    # Ativar controle de memória
max_memory_mb = 1024              # Limite de memória (MB) - 0 = automático (75% do sistema)
warning_percent = 60.0            # Aviso em 60% do limite
critical_percent = 75.0           # Crítico em 75% - inicia throttle (delay 500ms)
emergency_percent = 85.0          # Emergência em 85% - pausa capturas (delay 2s)
check_interval_seconds = 2        # Verifica memória a cada 2 segundos
gc_trigger_percent = 70.0         # Força garbage collection em 70%

# Comportamento por nível:
# - Normal (< 60%): Velocidade total
# - Warning (60-75%): Delay 100ms + GC automático
# - Critical (75-85%): Delay 500ms + GC agressivo + libera memória do SO
# - Emergency (> 85%): Pausa 2s + múltiplas rodadas de GC + libera memória

# ====================================================
# OTIMIZAÇÕES
# ====================================================
[optimization]
max_workers = 10                  # Workers reduzidos para economizar memória
buffer_size = 50                  # Buffer reduzido para 5 câmeras
worker_queue_size = 50
camera_buffer_size = 50
persistent_buffer_size = 25
use_persistent = true             # Usar captura persistente (mais eficiente)
circuit_max_failures = 5
circuit_reset_seconds = 60

# ====================================================
# RABBITMQ
# ====================================================
[amqp]
amqp_url = "amqp://user:password@localhost:5672/meu-cliente"
exchange = "cameras"
routing_key_prefix = "camera."

# ====================================================
# REDIS
# ====================================================
[redis]
enabled = true
address = "localhost:6379"
username = ""
password = ""
ttl_seconds = 300                 # Frames expiram em 5 minutos
prefix = "frames"

# ====================================================
# METADATA
# ====================================================
[metadata]
enabled = true
exchange = "camera.metadata"
routing_key = "camera.metadata.event"

# ====================================================
# COMPRESSÃO
# ====================================================
[compression]
enabled = false
level = 6

# ====================================================
# REGISTRO NA API (OPCIONAL)
# ====================================================
[registration]
enabled = false
api_url = "http://api.example.com/register"

# ====================================================
# CÂMERAS
# ====================================================
[[cameras]]
id = "cam1"
name = "Câmera 1"
url = "rtsp://admin:password@192.168.1.100:554/stream1"

[[cameras]]
id = "cam2"
name = "Câmera 2"
url = "rtsp://admin:password@192.168.1.101:554/stream1"

[[cameras]]
id = "cam3"
name = "Câmera 3"
url = "rtsp://admin:password@192.168.1.102:554/stream1"

[[cameras]]
id = "cam4"
name = "Câmera 4"
url = "rtsp://admin:password@192.168.1.103:554/stream1"

[[cameras]]
id = "cam5"
name = "Câmera 5"
url = "rtsp://admin:password@192.168.1.104:554/stream1"
